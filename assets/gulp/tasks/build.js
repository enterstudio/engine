/**
 * Gulp tasks for building JavaScript.
 */
const display = require('./util/display');
const uc = require('./util/unite-config');
const buildTranspile = require('./build-transpile');
const buildBundle = require('./build-bundle');
const buildLint = require('./build-lint');
const buildCss = require('./build-css');
const buildCssPost = require('./build-css-post');
const gulp = require('gulp');
const path = require('path');
const del = require('del');
const runSequence = require('run-sequence');

gulp.task('build-clean', (callback) => {
    const uniteConfig = uc.getUniteConfig();
    const toClean = [
        path.join(uniteConfig.directories.dist, "**/!(app-module-config).js"),
        path.join(uniteConfig.directories.cssDist, "**/*")
    ];
    display.info('Cleaning', toClean);
    return del(toClean, callback);
});

gulp.task('build-post-clean', (callback) => {
    const uniteConfig = uc.getUniteConfig();

    const toClean = [];

    if (uniteConfig.cssPost === 'None') {
        toClean.push(path.join(uniteConfig.directories.cssDist, "**/main.css"));
    } else {
        toClean.push(path.join(uniteConfig.directories.cssDist, "**/!(style).css"));
    }
    display.info('Cleaning', toClean);
    return del(toClean, callback);
});

gulp.task('build', (cb) => {
    runSequence('build-clean', 'build-lint', 'build-transpile', 'build-css', 'build-css-post', 'build-bundle', 'build-post-clean', cb);
});

/* Generated by UniteJS */
