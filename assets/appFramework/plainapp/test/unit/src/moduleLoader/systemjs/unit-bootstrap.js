/* Stop the tests from running while we manually load the modules */
window.__karma__.loaded = () => { };

var TEST_REGEXP = /(spec)\.js$/i;
var allTestFiles = [];

Object.keys(window.__karma__.files).forEach((file) => {
    if (TEST_REGEXP.test(file)) {
        allTestFiles.push(file.replace(/^\/base\/|\.js$/g, ''));
    }
});

var packages = unitModuleConfig.packages;
packages[''] = { defaultExtension: 'js' };

SystemJS.config({
    baseURL: '/base/',
    paths: unitModuleConfig.paths,
    packages: packages,
    meta: { /* Must set the module format to system, otherwise when coverage processes the module it won't be recognised */
        'dist/*': {
            format: 'system'
        }
    }
});

Promise.all(unitModuleConfig.preload).then(() => {
    Promise.all(allTestFiles.map((module) => { return SystemJS.import(module) }))
        .then((modules) =>{
            /* Now we have loaded all the modules we can start the tests */
            window.__karma__.start();
        });
});

/* Generated by UniteJS */
