"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class EngineVariables {
    constructor() {
        this._configuration = {};
        this.syntheticImport = "";
        this.moduleId = "";
        this.buildTranspileInclude = [];
        this.buildTranspilePreBuild = [];
        this.buildTranspilePostBuild = [];
        this._requiredDevDependencies = [];
        this._removedDevDependencies = [];
        this._requiredClientPackages = {};
        this._removedClientPackages = {};
        this._existingClientPackages = {};
        this.additionalCompletionMessages = [];
    }
    setConfiguration(name, config) {
        this._configuration[name] = config;
    }
    getConfiguration(name) {
        return this._configuration[name];
    }
    setupDirectories(fileSystem, rootFolder) {
        this.rootFolder = rootFolder;
        this.wwwRootFolder = fileSystem.pathCombine(this.rootFolder, "www");
        this.packagedRootFolder = fileSystem.pathCombine(this.rootFolder, "packaged");
        this.platformRootFolder = fileSystem.pathCombine(this.rootFolder, "platform");
        this.www = {
            srcFolder: fileSystem.pathCombine(this.wwwRootFolder, "src"),
            distFolder: fileSystem.pathCombine(this.wwwRootFolder, "dist"),
            cssSrcFolder: fileSystem.pathCombine(this.wwwRootFolder, "cssSrc"),
            cssDistFolder: fileSystem.pathCombine(this.wwwRootFolder, "css"),
            e2eTestFolder: fileSystem.pathCombine(this.wwwRootFolder, "test/e2e"),
            e2eTestSrcFolder: fileSystem.pathCombine(this.wwwRootFolder, "test/e2e/src"),
            e2eTestDistFolder: fileSystem.pathCombine(this.wwwRootFolder, "test/e2e/dist"),
            unitTestFolder: fileSystem.pathCombine(this.wwwRootFolder, "test/unit"),
            unitTestSrcFolder: fileSystem.pathCombine(this.wwwRootFolder, "test/unit/src"),
            unitTestDistFolder: fileSystem.pathCombine(this.wwwRootFolder, "test/unit/dist"),
            reportsFolder: fileSystem.pathCombine(this.wwwRootFolder, "test/reports"),
            assetsFolder: fileSystem.pathCombine(this.wwwRootFolder, "assets"),
            assetsSrcFolder: fileSystem.pathCombine(this.wwwRootFolder, "assetsSrc"),
            buildFolder: fileSystem.pathCombine(this.wwwRootFolder, "build"),
            packageFolder: fileSystem.pathCombine(this.wwwRootFolder, "node_modules"),
            configurationFolder: fileSystem.pathCombine(this.wwwRootFolder, "configuration")
        };
    }
    initialisePackages(clientPackages) {
        this._existingClientPackages = clientPackages;
    }
    toggleClientPackage(key, clientPackage, required) {
        if (required) {
            this.addClientPackage(key, clientPackage);
        }
        else {
            this.removeClientPackage(key, clientPackage);
        }
    }
    addClientPackage(key, clientPackage) {
        if (!clientPackage.version) {
            clientPackage.version = this.findDependencyVersion(clientPackage.name);
        }
        this._requiredClientPackages[key] = clientPackage;
    }
    removeClientPackage(key, clientPackage) {
        this._removedClientPackages[key] = clientPackage;
    }
    toggleDevDependency(dependencies, required) {
        if (required) {
            this.addDevDependency(dependencies);
        }
        else {
            this.removeDevDependency(dependencies);
        }
    }
    addDevDependency(dependencies) {
        dependencies.forEach(dep => {
            if (this._requiredDevDependencies.indexOf(dep) < 0) {
                this._requiredDevDependencies.push(dep);
            }
        });
    }
    removeDevDependency(dependencies) {
        dependencies.forEach(dep => {
            if (this._removedDevDependencies.indexOf(dep) < 0) {
                this._removedDevDependencies.push(dep);
            }
        });
    }
    buildDependencies(uniteConfiguration, packageJsonDependencies) {
        for (const key in this._removedClientPackages) {
            const pkg = this._removedClientPackages[key];
            if (packageJsonDependencies[pkg.name]) {
                delete packageJsonDependencies[pkg.name];
            }
            if (this._existingClientPackages[key] &&
                !this._existingClientPackages[key].hasOverrides) {
                delete this._existingClientPackages[key];
            }
        }
        for (const key in this._existingClientPackages) {
            const pkg = this._existingClientPackages[key];
            if (pkg.hasOverrides || !this._requiredClientPackages[key]) {
                this._requiredClientPackages[key] = pkg;
            }
        }
        const addedTestDependencies = [];
        const removedTestDependencies = [];
        for (const key in this._requiredClientPackages) {
            const pkg = this._requiredClientPackages[key];
            uniteConfiguration.clientPackages[key] = pkg;
            if (pkg.includeMode === "app" || pkg.includeMode === "both") {
                packageJsonDependencies[pkg.name] = pkg.version;
                const idx = this._requiredDevDependencies.indexOf(pkg.name);
                if (idx >= 0) {
                    this._requiredDevDependencies.splice(idx, 1);
                    removedTestDependencies.push(pkg.name);
                }
            }
            else {
                addedTestDependencies.push(pkg.name);
            }
        }
        this.toggleDevDependency(addedTestDependencies, true);
        this.toggleDevDependency(removedTestDependencies, false);
    }
    buildDevDependencies(packageJsonDevDependencies) {
        this._removedDevDependencies.forEach(dependency => {
            if (packageJsonDevDependencies[dependency]) {
                delete packageJsonDevDependencies[dependency];
            }
        });
        this._requiredDevDependencies.forEach(requiredDependency => {
            packageJsonDevDependencies[requiredDependency] = this.findDependencyVersion(requiredDependency);
        });
    }
    findDependencyVersion(requiredDependency) {
        if (this.engineDependencies) {
            if (this.engineDependencies[requiredDependency]) {
                return this.engineDependencies[requiredDependency];
            }
            else {
                throw new Error(`Missing Dependency '${requiredDependency}'`);
            }
        }
        else {
            throw new Error("Dependency Versions missing");
        }
    }
}
exports.EngineVariables = EngineVariables;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lbmdpbmUvZW5naW5lVmFyaWFibGVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBU0E7SUFtREk7UUFDSSxJQUFJLENBQUMsY0FBYyxHQUFHLEVBQUUsQ0FBQztRQUV6QixJQUFJLENBQUMsZUFBZSxHQUFHLEVBQUUsQ0FBQztRQUMxQixJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztRQUVuQixJQUFJLENBQUMscUJBQXFCLEdBQUcsRUFBRSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxFQUFFLENBQUM7UUFDakMsSUFBSSxDQUFDLHVCQUF1QixHQUFHLEVBQUUsQ0FBQztRQUVsQyxJQUFJLENBQUMsd0JBQXdCLEdBQUcsRUFBRSxDQUFDO1FBQ25DLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxFQUFFLENBQUM7UUFDbEMsSUFBSSxDQUFDLHVCQUF1QixHQUFHLEVBQUUsQ0FBQztRQUNsQyxJQUFJLENBQUMsc0JBQXNCLEdBQUcsRUFBRSxDQUFDO1FBQ2pDLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxFQUFFLENBQUM7UUFFbEMsSUFBSSxDQUFDLDRCQUE0QixHQUFHLEVBQUUsQ0FBQztJQUMzQyxDQUFDO0lBRU0sZ0JBQWdCLENBQUMsSUFBWSxFQUFFLE1BQVc7UUFDN0MsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLENBQUM7SUFDdkMsQ0FBQztJQUVNLGdCQUFnQixDQUFJLElBQVk7UUFDbkMsTUFBTSxDQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVNLGdCQUFnQixDQUFDLFVBQXVCLEVBQUUsVUFBa0I7UUFDL0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7UUFDN0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxVQUFVLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDcEUsSUFBSSxD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d0IsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsRUFBRTtZQUN2RCwwQkFBMEIsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ3BHLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVNLHFCQUFxQixDQUFDLGtCQUEwQjtRQUNuRCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDO1lBQzFCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDOUMsTUFBTSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBQ3ZELENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDSixNQUFNLElBQUksS0FBSyxDQUFDLHVCQUF1QixrQkFBa0IsR0FBRyxDQUFDLENBQUM7WUFDbEUsQ0FBQztRQUNMLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNKLE1BQU0sSUFBSSxLQUFLLENBQUMsNkJBQTZCLENBQUMsQ0FBQztRQUNuRCxDQUFDO0lBQ0wsQ0FBQztDQUNKO0FBek5ELDBDQXlOQyIsImZpbGUiOiJlbmdpbmUvZW5naW5lVmFyaWFibGVzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBWYXJpYWJsZXMgdXNlZCBieSB0aGUgZW5naW5lLlxuICovXG5pbXBvcnQgeyBJRmlsZVN5c3RlbSB9IGZyb20gXCJ1bml0ZWpzLWZyYW1ld29yay9kaXN0L2ludGVyZmFjZXMvSUZpbGVTeXN0ZW1cIjtcbmltcG9ydCB7IFVuaXRlQ2xpZW50UGFja2FnZSB9IGZyb20gXCIuLi9jb25maWd1cmF0aW9uL21vZGVscy91bml0ZS91bml0ZUNsaWVudFBhY2thZ2VcIjtcbmltcG9ydCB7IFVuaXRlQ29uZmlndXJhdGlvbiB9IGZyb20gXCIuLi9jb25maWd1cmF0aW9uL21vZGVscy91bml0ZS91bml0ZUNvbmZpZ3VyYXRpb25cIjtcbmltcG9ydCB7IElQYWNrYWdlTWFuYWdlciB9IGZyb20gXCIuLi9pbnRlcmZhY2VzL0lQYWNrYWdlTWFuYWdlclwiO1xuaW1wb3J0IHsgRW5naW5lVmFyaWFibGVzTWV0YSB9IGZyb20gXCIuL2VuZ2luZVZhcmlhYmxlc01ldGFcIjtcblxuZXhwb3J0IGNsYXNzIEVuZ2luZVZhcmlhYmxlcyB7XG4gICAgcHVibGljIG1ldGE6IEVuZ2luZVZhcmlhYmxlc01ldGE7XG4gICAgcHVibGljIGZvcmNlOiBib29sZWFuO1xuICAgIHB1YmxpYyBlbmdpbmVSb290Rm9sZGVyOiBzdHJpbmc7XG4gICAgcHVibGljIGVuZ2luZUFzc2V0c0ZvbGRlcjogc3RyaW5nO1xuICAgIHB1YmxpYyBlbmdpbmVWZXJzaW9uOiBzdHJpbmc7XG4gICAgcHVibGljIGVuZ2luZURlcGVuZGVuY2llczogeyBbaWQ6IHN0cmluZ106IHN0cmluZyB9O1xuXG4gICAgcHVibGljIHJvb3RGb2xkZXI6IHN0cmluZztcbiAgICBwdWJsaWMgd3d3Um9vdEZvbGRlcjogc3RyaW5nO1xuICAgIHB1YmxpYyBwYWNrYWdlZFJvb3RGb2xkZXI6IHN0cmluZztcbiAgICBwdWJsaWMgcGxhdGZvcm1Sb290Rm9sZGVyOiBzdHJpbmc7XG5cbiAgICBwdWJsaWMgd3d3OiB7XG4gICAgICAgIHNyY0ZvbGRlcjogc3RyaW5nO1xuICAgICAgICBkaXN0Rm9sZGVyOiBzdHJpbmc7XG4gICAgICAgIHVuaXRUZXN0Rm9sZGVyOiBzdHJpbmc7XG4gICAgICAgIHVuaXRUZXN0U3JjRm9sZGVyOiBzdHJpbmc7XG4gICAgICAgIHVuaXRUZXN0RGlzdEZvbGRlcjogc3RyaW5nO1xuICAgICAgICBjc3NTcmNGb2xkZXI6IHN0cmluZztcbiAgICAgICAgY3NzRGlzdEZvbGRlcjogc3RyaW5nO1xuICAgICAgICBlMmVUZXN0Rm9sZGVyOiBzdHJpbmc7XG4gICAgICAgIGUyZVRlc3RTcmNGb2xkZXI6IHN0cmluZztcbiAgICAgICAgZTJlVGVzdERpc3RGb2xkZXI6IHN0cmluZztcbiAgICAgICAgcmVwb3J0c0ZvbGRlcjogc3RyaW5nO1xuICAgICAgICBwYWNrYWdlRm9sZGVyOiBzdHJpbmc7XG4gICAgICAgIGJ1aWxkRm9sZGVyOiBzdHJpbmc7XG4gICAgICAgIGNvbmZpZ3VyYXRpb25Gb2xkZXI6IHN0cmluZztcblxuICAgICAgICBhc3NldHNGb2xkZXI6IHN0cmluZztcbiAgICAgICAgYXNzZXRzU3JjRm9sZGVyOiBzdHJpbmc7XG4gICAgfTtcblxuICAgIHB1YmxpYyBidWlsZFRyYW5zcGlsZUluY2x1ZGU6IHN0cmluZ1tdO1xuICAgIHB1YmxpYyBidWlsZFRyYW5zcGlsZVByZUJ1aWxkOiBzdHJpbmdbXTtcbiAgICBwdWJsaWMgYnVpbGRUcmFuc3BpbGVQb3N0QnVpbGQ6IHN0cmluZ1tdO1xuXG4gICAgcHVibGljIHN5bnRoZXRpY0ltcG9ydDogc3RyaW5nO1xuICAgIHB1YmxpYyBtb2R1bGVJZDogc3RyaW5nO1xuXG4gICAgcHVibGljIHBhY2thZ2VNYW5hZ2VyOiBJUGFja2FnZU1hbmFnZXI7XG4gICAgcHVibGljIGFkZGl0aW9uYWxDb21wbGV0aW9uTWVzc2FnZXM6IHN0cmluZ1tdO1xuXG4gICAgcHJpdmF0ZSBfY29uZmlndXJhdGlvbjogeyBbaWQ6IHN0cmluZ106IGFueSB9O1xuXG4gICAgcHJpdmF0ZSBfcmVxdWlyZWREZXZEZXBlbmRlbmNpZXM6IHN0cmluZ1tdO1xuICAgIHByaXZhdGUgX3JlbW92ZWREZXZEZXBlbmRlbmNpZXM6IHN0cmluZ1tdO1xuICAgIHByaXZhdGUgX3JlcXVpcmVkQ2xpZW50UGFja2FnZXM6IHsgW2lkOiBzdHJpbmddOiBVbml0ZUNsaWVudFBhY2thZ2UgfTtcbiAgICBwcml2YXRlIF9yZW1vdmVkQ2xpZW50UGFja2FnZXM6IHsgW2lkOiBzdHJpbmddOiBVbml0ZUNsaWVudFBhY2thZ2UgfTtcbiAgICBwcml2YXRlIF9leGlzdGluZ0NsaWVudFBhY2thZ2VzOiB7IFtpZDogc3RyaW5nXTogVW5pdGVDbGllbnRQYWNrYWdlIH07XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5fY29uZmlndXJhdGlvbiA9IHt9O1xuXG4gICAgICAgIHRoaXMuc3ludGhldGljSW1wb3J0ID0gXCJcIjtcbiAgICAgICAgdGhpcy5tb2R1bGVJZCA9IFwiXCI7XG5cbiAgICAgICAgdGhpcy5idWlsZFRyYW5zcGlsZUluY2x1ZGUgPSBbXTtcbiAgICAgICAgdGhpcy5idWlsZFRyYW5zcGlsZVByZUJ1aWxkID0gW107XG4gICAgICAgIHRoaXMuYnVpbGRUcmFuc3BpbGVQb3N0QnVpbGQgPSBbXTtcblxuICAgICAgICB0aGlzLl9yZXF1aXJlZERldkRlcGVuZGVuY2llcyA9IFtdO1xuICAgICAgICB0aGlzLl9yZW1vdmVkRGV2RGVwZW5kZW5jaWVzID0gW107XG4gICAgICAgIHRoaXMuX3JlcXVpcmVkQ2xpZW50UGFja2FnZXMgPSB7fTtcbiAgICAgICAgdGhpcy5fcmVtb3ZlZENsaWVudFBhY2thZ2VzID0ge307XG4gICAgICAgIHRoaXMuX2V4aXN0aW5nQ2xpZW50UGFja2FnZXMgPSB7fTtcblxuICAgICAgICB0aGlzLmFkZGl0aW9uYWxDb21wbGV0aW9uTWVzc2FnZXMgPSBbXTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0Q29uZmlndXJhdGlvbihuYW1lOiBzdHJpbmcsIGNvbmZpZzogYW55KTogdm9pZCB7XG4gICAgICAgIHRoaXMuX2NvbmZpZ3VyYXRpb25bbmFtZV0gPSBjb25maWc7XG4gICAgfVxuXG4gICAgcHVibGljIGdldENvbmZpZ3VyYXRpb248VD4obmFtZTogc3RyaW5nKTogVCB7XG4gICAgICAgIHJldHVybiA8VD50aGlzLl9jb25maWd1cmF0aW9uW25hbWVdO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXR1cERpcmVjdG9yaWVzKGZpbGVTeXN0ZW06IElGaWxlU3lzdGVtLCByb290Rm9sZGVyOiBzdHJpbmcpIDogdm9pZCB7XG4gICAgICAgIHRoaXMucm9vdEZvbGRlciA9IHJvb3RGb2xkZXI7XG4gICAgICAgIHRoaXMud3d3Um9vdEZvbGRlciA9IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy5yb290Rm9sZGVyLCBcInd3d1wiKTtcbiAgICAgICAgdGhpcy5wYWNrYWdlZFJvb3RGb2xkZXIgPSBmaWxlU3lzdGVtLnBhdGhDb21iaW5lKHRoaXMucm9vdEZvbGRlciwgXCJwYWNrYWdlZFwiKTtcbiAgICAgICAgdGhpcy5wbGF0Zm9ybVJvb3RGb2xkZXIgPSBmaWxlU3lzdGVtLnBhdGhDb21iaW5lKHRoaXMucm9vdEZvbGRlciwgXCJwbGF0Zm9ybVwiKTtcbiAgICAgICAgdGhpcy53d3cgPSB7XG4gICAgICAgICAgICBzcmNGb2xkZXI6IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy53d3dSb290Rm9sZGVyLCBcInNyY1wiKSxcbiAgICAgICAgICAgIGRpc3RGb2xkZXI6IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy53d3dSb290Rm9sZGVyLCBcImRpc3RcIiksXG4gICAgICAgICAgICBjc3NTcmNGb2xkZXI6IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy53d3dSb290Rm9sZGVyLCBcImNzc1NyY1wiKSxcbiAgICAgICAgICAgIGNzc0Rpc3RGb2xkZXI6IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy53d3dSb290Rm9sZGVyLCBcImNzc1wiKSxcbiAgICAgICAgICAgIGUyZVRlc3RGb2xkZXI6IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy53d3dSb290Rm9sZGVyLCBcInRlc3QvZTJlXCIpLFxuICAgICAgICAgICAgZTJlVGVzdFNyY0ZvbGRlcjogZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnd3d1Jvb3RGb2xkZXIsIFwidGVzdC9lMmUvc3JjXCIpLFxuICAgICAgICAgICAgZTJlVGVzdERpc3RGb2xkZXI6IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy53d3dSb290Rm9sZGVyLCBcInRlc3QvZTJlL2Rpc3RcIiksXG4gICAgICAgICAgICB1bml0VGVzdEZvbGRlcjogZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnd3d1Jvb3RGb2xkZXIsIFwidGVzdC91bml0XCIpLFxuICAgICAgICAgICAgdW5pdFRlc3RTcmNGb2xkZXI6IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy53d3dSb290Rm9sZGVyLCBcInRlc3QvdW5pdC9zcmNcIiksXG4gICAgICAgICAgICB1bml0VGVzdERpc3RGb2xkZXI6IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy53d3dSb290Rm9sZGVyLCBcInRlc3QvdW5pdC9kaXN0XCIpLFxuICAgICAgICAgICAgcmVwb3J0c0ZvbGRlcjogZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnd3d1Jvb3RGb2xkZXIsIFwidGVzdC9yZXBvcnRzXCIpLFxuICAgICAgICAgICAgYXNzZXRzRm9sZGVyOiBmaWxlU3lzdGVtLnBhdGhDb21iaW5lKHRoaXMud3d3Um9vdEZvbGRlciwgXCJhc3NldHNcIiksXG4gICAgICAgICAgICBhc3NldHNTcmNGb2xkZXI6IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy53d3dSb290Rm9sZGVyLCBcImFzc2V0c1NyY1wiKSxcbiAgICAgICAgICAgIGJ1aWxkRm9sZGVyOiBmaWxlU3lzdGVtLnBhdGhDb21iaW5lKHRoaXMud3d3Um9vdEZvbGRlciwgXCJidWlsZFwiKSxcbiAgICAgICAgICAgIHBhY2thZ2VGb2xkZXI6IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy53d3dSb290Rm9sZGVyLCBcIm5vZGVfbW9kdWxlc1wiKSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb25Gb2xkZXI6IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy53d3dSb290Rm9sZGVyLCBcImNvbmZpZ3VyYXRpb25cIilcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaW5pdGlhbGlzZVBhY2thZ2VzKGNsaWVudFBhY2thZ2VzOiB7IFtpZDogc3RyaW5nXTogVW5pdGVDbGllbnRQYWNrYWdlIH0pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fZXhpc3RpbmdDbGllbnRQYWNrYWdlcyA9IGNsaWVudFBhY2thZ2VzO1xuICAgIH1cblxuICAgIHB1YmxpYyB0b2dnbGVDbGllbnRQYWNrYWdlKGtleTogc3RyaW5nLCBjbGllbnRQYWNrYWdlOiBVbml0ZUNsaWVudFBhY2thZ2UsIHJlcXVpcmVkOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIGlmIChyZXF1aXJlZCkge1xuICAgICAgICAgICAgdGhpcy5hZGRDbGllbnRQYWNrYWdlKGtleSwgY2xpZW50UGFja2FnZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZUNsaWVudFBhY2thZ2Uoa2V5LCBjbGllbnRQYWNrYWdlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBhZGRDbGllbnRQYWNrYWdlKGtleTogc3RyaW5nLCBjbGllbnRQYWNrYWdlOiBVbml0ZUNsaWVudFBhY2thZ2UpOiB2b2lkIHtcbiAgICAgICAgaWYgKCFjbGllbnRQYWNrYWdlLnZlcnNpb24pIHtcbiAgICAgICAgICAgIGNsaWVudFBhY2thZ2UudmVyc2lvbiA9IHRoaXMuZmluZERlcGVuZGVuY3lWZXJzaW9uKGNsaWVudFBhY2thZ2UubmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcmVxdWlyZWRDbGllbnRQYWNrYWdlc1trZXldID0gY2xpZW50UGFja2FnZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVtb3ZlQ2xpZW50UGFja2FnZShrZXk6IHN0cmluZywgY2xpZW50UGFja2FnZTogVW5pdGVDbGllbnRQYWNrYWdlKTogdm9pZCB7XG4gICAgICAgIHRoaXMuX3JlbW92ZWRDbGllbnRQYWNrYWdlc1trZXldID0gY2xpZW50UGFja2FnZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdG9nZ2xlRGV2RGVwZW5kZW5jeShkZXBlbmRlbmNpZXM6IHN0cmluZ1tdLCByZXF1aXJlZDogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICBpZiAocmVxdWlyZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkRGV2RGVwZW5kZW5jeShkZXBlbmRlbmNpZXMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVEZXZEZXBlbmRlbmN5KGRlcGVuZGVuY2llcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgYWRkRGV2RGVwZW5kZW5jeShkZXBlbmRlbmNpZXM6IHN0cmluZ1tdKTogdm9pZCB7XG4gICAgICAgIGRlcGVuZGVuY2llcy5mb3JFYWNoKGRlcCA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5fcmVxdWlyZWREZXZEZXBlbmRlbmNpZXMuaW5kZXhPZihkZXApIDwgMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVpcmVkRGV2RGVwZW5kZW5jaWVzLnB1c2goZGVwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbW92ZURldkRlcGVuZGVuY3koZGVwZW5kZW5jaWVzOiBzdHJpbmdbXSk6IHZvaWQge1xuICAgICAgICBkZXBlbmRlbmNpZXMuZm9yRWFjaChkZXAgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuX3JlbW92ZWREZXZEZXBlbmRlbmNpZXMuaW5kZXhPZihkZXApIDwgMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZWREZXZEZXBlbmRlbmNpZXMucHVzaChkZXApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYnVpbGREZXBlbmRlbmNpZXModW5pdGVDb25maWd1cmF0aW9uOiBVbml0ZUNvbmZpZ3VyYXRpb24sIHBhY2thZ2VKc29uRGVwZW5kZW5jaWVzOiB7IFtpZDogc3RyaW5nXTogc3RyaW5nIH0pOiB2b2lkIHtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy5fcmVtb3ZlZENsaWVudFBhY2thZ2VzKSB7XG4gICAgICAgICAgICBjb25zdCBwa2cgPSB0aGlzLl9yZW1vdmVkQ2xpZW50UGFja2FnZXNba2V5XTtcblxuICAgICAgICAgICAgaWYgKHBhY2thZ2VKc29uRGVwZW5kZW5jaWVzW3BrZy5uYW1lXSkge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBwYWNrYWdlSnNvbkRlcGVuZGVuY2llc1twa2cubmFtZV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLl9leGlzdGluZ0NsaWVudFBhY2thZ2VzW2tleV0gJiZcbiAgICAgICAgICAgICAgICAhdGhpcy5fZXhpc3RpbmdDbGllbnRQYWNrYWdlc1trZXldLmhhc092ZXJyaWRlcykge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9leGlzdGluZ0NsaWVudFBhY2thZ2VzW2tleV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLl9leGlzdGluZ0NsaWVudFBhY2thZ2VzKSB7XG4gICAgICAgICAgICBjb25zdCBwa2cgPSB0aGlzLl9leGlzdGluZ0NsaWVudFBhY2thZ2VzW2tleV07XG5cbiAgICAgICAgICAgIGlmIChwa2cuaGFzT3ZlcnJpZGVzIHx8ICF0aGlzLl9yZXF1aXJlZENsaWVudFBhY2thZ2VzW2tleV0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZXF1aXJlZENsaWVudFBhY2thZ2VzW2tleV0gPSBwa2c7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhZGRlZFRlc3REZXBlbmRlbmNpZXMgPSBbXTtcbiAgICAgICAgY29uc3QgcmVtb3ZlZFRlc3REZXBlbmRlbmNpZXMgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy5fcmVxdWlyZWRDbGllbnRQYWNrYWdlcykge1xuICAgICAgICAgICAgY29uc3QgcGtnID0gdGhpcy5fcmVxdWlyZWRDbGllbnRQYWNrYWdlc1trZXldO1xuXG4gICAgICAgICAgICB1bml0ZUNvbmZpZ3VyYXRpb24uY2xpZW50UGFja2FnZXNba2V5XSA9IHBrZztcbiAgICAgICAgICAgIGlmIChwa2cuaW5jbHVkZU1vZGUgPT09IFwiYXBwXCIgfHwgcGtnLmluY2x1ZGVNb2RlID09PSBcImJvdGhcIikge1xuICAgICAgICAgICAgICAgIHBhY2thZ2VKc29uRGVwZW5kZW5jaWVzW3BrZy5uYW1lXSA9IHBrZy52ZXJzaW9uO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5fcmVxdWlyZWREZXZEZXBlbmRlbmNpZXMuaW5kZXhPZihwa2cubmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKGlkeCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVpcmVkRGV2RGVwZW5kZW5jaWVzLnNwbGljZShpZHgsIDEpO1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVkVGVzdERlcGVuZGVuY2llcy5wdXNoKHBrZy5uYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFkZGVkVGVzdERlcGVuZGVuY2llcy5wdXNoKHBrZy5uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRvZ2dsZURldkRlcGVuZGVuY3koYWRkZWRUZXN0RGVwZW5kZW5jaWVzLCB0cnVlKTtcbiAgICAgICAgdGhpcy50b2dnbGVEZXZEZXBlbmRlbmN5KHJlbW92ZWRUZXN0RGVwZW5kZW5jaWVzLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgcHVibGljIGJ1aWxkRGV2RGVwZW5kZW5jaWVzKHBhY2thZ2VKc29uRGV2RGVwZW5kZW5jaWVzOiB7IFtpZDogc3RyaW5nXTogc3RyaW5nIH0pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fcmVtb3ZlZERldkRlcGVuZGVuY2llcy5mb3JFYWNoKGRlcGVuZGVuY3kgPT4ge1xuICAgICAgICAgICAgaWYgKHBhY2thZ2VKc29uRGV2RGVwZW5kZW5jaWVzW2RlcGVuZGVuY3ldKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHBhY2thZ2VKc29uRGV2RGVwZW5kZW5jaWVzW2RlcGVuZGVuY3ldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLl9yZXF1aXJlZERldkRlcGVuZGVuY2llcy5mb3JFYWNoKHJlcXVpcmVkRGVwZW5kZW5jeSA9PiB7XG4gICAgICAgICAgICBwYWNrYWdlSnNvbkRldkRlcGVuZGVuY2llc1tyZXF1aXJlZERlcGVuZGVuY3ldID0gdGhpcy5maW5kRGVwZW5kZW5jeVZlcnNpb24ocmVxdWlyZWREZXBlbmRlbmN5KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGZpbmREZXBlbmRlbmN5VmVyc2lvbihyZXF1aXJlZERlcGVuZGVuY3k6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGlmICh0aGlzLmVuZ2luZURlcGVuZGVuY2llcykge1xuICAgICAgICAgICAgaWYgKHRoaXMuZW5naW5lRGVwZW5kZW5jaWVzW3JlcXVpcmVkRGVwZW5kZW5jeV0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmdpbmVEZXBlbmRlbmNpZXNbcmVxdWlyZWREZXBlbmRlbmN5XTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIERlcGVuZGVuY3kgJyR7cmVxdWlyZWREZXBlbmRlbmN5fSdgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRlcGVuZGVuY3kgVmVyc2lvbnMgbWlzc2luZ1wiKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==
