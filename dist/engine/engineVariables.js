"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class EngineVariables {
    constructor() {
        this._configuration = {};
        this.syntheticImport = "";
        this.moduleId = "";
        this.buildTranspileInclude = [];
        this.buildTranspilePreBuild = [];
        this.buildTranspilePostBuild = [];
        this._requiredDevDependencies = [];
        this._removedDevDependencies = [];
        this._requiredClientPackages = {};
        this._removedClientPackages = {};
        this._existingClientPackages = {};
    }
    setConfiguration(name, config) {
        this._configuration[name] = config;
    }
    getConfiguration(name) {
        return this._configuration[name];
    }
    setupDirectories(fileSystem, rootFolder) {
        this.rootFolder = rootFolder;
        this.wwwRootFolder = fileSystem.pathCombine(this.rootFolder, "www");
        this.packagedRootFolder = fileSystem.pathCombine(this.rootFolder, "packaged");
        this.platformRootFolder = fileSystem.pathCombine(this.rootFolder, "platform");
        this.www = {
            srcFolder: fileSystem.pathCombine(this.wwwRootFolder, "src"),
            distFolder: fileSystem.pathCombine(this.wwwRootFolder, "dist"),
            cssSrcFolder: fileSystem.pathCombine(this.wwwRootFolder, "cssSrc"),
            cssDistFolder: fileSystem.pathCombine(this.wwwRootFolder, "css"),
            e2eTestFolder: fileSystem.pathCombine(this.wwwRootFolder, "test/e2e"),
            e2eTestSrcFolder: fileSystem.pathCombine(this.wwwRootFolder, "test/e2e/src"),
            e2eTestDistFolder: fileSystem.pathCombine(this.wwwRootFolder, "test/e2e/dist"),
            unitTestFolder: fileSystem.pathCombine(this.wwwRootFolder, "test/unit"),
            unitTestSrcFolder: fileSystem.pathCombine(this.wwwRootFolder, "test/unit/src"),
            unitTestDistFolder: fileSystem.pathCombine(this.wwwRootFolder, "test/unit/dist"),
            reportsFolder: fileSystem.pathCombine(this.wwwRootFolder, "test/reports"),
            assetsFolder: fileSystem.pathCombine(this.wwwRootFolder, "assets"),
            assetsSrcFolder: fileSystem.pathCombine(this.wwwRootFolder, "assetsSrc"),
            buildFolder: fileSystem.pathCombine(this.wwwRootFolder, "build"),
            packageFolder: fileSystem.pathCombine(this.wwwRootFolder, "node_modules"),
            configurationFolder: fileSystem.pathCombine(this.wwwRootFolder, "configuration")
        };
    }
    initialisePackages(clientPackages) {
        this._existingClientPackages = clientPackages;
    }
    toggleClientPackage(key, clientPackage, required) {
        if (required) {
            this.addClientPackage(key, clientPackage);
        }
        else {
            this.removeClientPackage(key, clientPackage);
        }
    }
    addClientPackage(key, clientPackage) {
        if (!clientPackage.version) {
            clientPackage.version = this.findDependencyVersion(clientPackage.name);
        }
        this._requiredClientPackages[key] = clientPackage;
    }
    removeClientPackage(key, clientPackage) {
        this._removedClientPackages[key] = clientPackage;
    }
    toggleDevDependency(dependencies, required) {
        if (required) {
            this.addDevDependency(dependencies);
        }
        else {
            this.removeDevDependency(dependencies);
        }
    }
    addDevDependency(dependencies) {
        dependencies.forEach(dep => {
            if (this._requiredDevDependencies.indexOf(dep) < 0) {
                this._requiredDevDependencies.push(dep);
            }
        });
    }
    removeDevDependency(dependencies) {
        dependencies.forEach(dep => {
            if (this._removedDevDependencies.indexOf(dep) < 0) {
                this._removedDevDependencies.push(dep);
            }
        });
    }
    buildDependencies(uniteConfiguration, packageJsonDependencies) {
        for (const key in this._removedClientPackages) {
            const pkg = this._removedClientPackages[key];
            if (packageJsonDependencies[pkg.name]) {
                delete packageJsonDependencies[pkg.name];
            }
            if (this._existingClientPackages[key] &&
                !this._existingClientPackages[key].hasOverrides) {
                delete this._existingClientPackages[key];
            }
        }
        for (const key in this._existingClientPackages) {
            const pkg = this._existingClientPackages[key];
            if (pkg.hasOverrides || !this._requiredClientPackages[key]) {
                this._requiredClientPackages[key] = pkg;
            }
        }
        const addedTestDependencies = [];
        const removedTestDependencies = [];
        for (const key in this._requiredClientPackages) {
            const pkg = this._requiredClientPackages[key];
            uniteConfiguration.clientPackages[key] = pkg;
            if (pkg.includeMode === "app" || pkg.includeMode === "both") {
                packageJsonDependencies[pkg.name] = pkg.version;
                const idx = this._requiredDevDependencies.indexOf(pkg.name);
                if (idx >= 0) {
                    this._requiredDevDependencies.splice(idx, 1);
                    removedTestDependencies.push(pkg.name);
                }
            }
            else {
                addedTestDependencies.push(pkg.name);
            }
        }
        this.toggleDevDependency(addedTestDependencies, true);
        this.toggleDevDependency(removedTestDependencies, false);
    }
    buildDevDependencies(packageJsonDevDependencies) {
        this._removedDevDependencies.forEach(dependency => {
            if (packageJsonDevDependencies[dependency]) {
                delete packageJsonDevDependencies[dependency];
            }
        });
        this._requiredDevDependencies.forEach(requiredDependency => {
            packageJsonDevDependencies[requiredDependency] = this.findDependencyVersion(requiredDependency);
        });
    }
    findDependencyVersion(requiredDependency) {
        if (this.engineDependencies) {
            if (this.engineDependencies[requiredDependency]) {
                return this.engineDependencies[requiredDependency];
            }
            else {
                throw new Error(`Missing Dependency '${requiredDependency}'`);
            }
        }
        else {
            throw new Error("Dependency Versions missing");
        }
    }
}
exports.EngineVariables = EngineVariables;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lbmdpbmUvZW5naW5lVmFyaWFibGVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBUUE7SUFpREk7UUFDSSxJQUFJLENBQUMsY0FBYyxHQUFHLEVBQUUsQ0FBQztRQUV6QixJQUFJLENBQUMsZUFBZSxHQUFHLEVBQUUsQ0FBQztRQUMxQixJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztRQUVuQixJQUFJLENBQUMscUJBQXFCLEdBQUcsRUFBRSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxFQUFFLENBQUM7UUFDakMsSUFBSSxDQUFDLHVCQUF1QixHQUFHLEVBQUUsQ0FBQztRQUVsQyxJQUFJLENBQUMsd0JBQXdCLEdBQUcsRUFBRSxDQUFDO1FBQ25DLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxFQUFFLENBQUM7UUFDbEMsSUFBSSxDQUFDLHVCQUF1QixHQUFHLEVBQUUsQ0FBQztRQUNsQyxJQUFJLENBQUMsc0JBQXNCLEdBQUcsRUFBRSxDQUFDO1FBQ2pDLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxFQUFFLENBQUM7SUFDdEMsQ0FBQztJQUVNLGdCQUFnQixDQUFDLElBQVksRUFBRSxNQUFXO1FBQzdDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDO0lBQ3ZDLENBQUM7SUFFTSxnQkFBZ0IsQ0FBSSxJQUFZO1FBQ25DLE1BQU0sQ0FBSSxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFFTSxnQkFBZ0IsQ0FBQyxVQUF1QixFQUFFLFVBQWtCO1FBQy9ELElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxhQUFhLEdBQUcsVUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3BFLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxVQUFVLENBQUMsV0FBVyxDQUFDLElB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dkQsMEJBQTBCLENBQUMsa0JBQWtCLENBQUMsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUNwRyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFTSxxQkFBcUIsQ0FBQyxrQkFBMEI7UUFDbkQsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQztZQUMxQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzlDLE1BQU0sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUN2RCxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ0osTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUIsa0JBQWtCLEdBQUcsQ0FBQyxDQUFDO1lBQ2xFLENBQUM7UUFDTCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSixNQUFNLElBQUksS0FBSyxDQUFDLDZCQUE2QixDQUFDLENBQUM7UUFDbkQsQ0FBQztJQUNMLENBQUM7Q0FDSjtBQXJORCwwQ0FxTkMiLCJmaWxlIjoiZW5naW5lL2VuZ2luZVZhcmlhYmxlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVmFyaWFibGVzIHVzZWQgYnkgdGhlIGVuZ2luZS5cbiAqL1xuaW1wb3J0IHsgSUZpbGVTeXN0ZW0gfSBmcm9tIFwidW5pdGVqcy1mcmFtZXdvcmsvZGlzdC9pbnRlcmZhY2VzL0lGaWxlU3lzdGVtXCI7XG5pbXBvcnQgeyBVbml0ZUNsaWVudFBhY2thZ2UgfSBmcm9tIFwiLi4vY29uZmlndXJhdGlvbi9tb2RlbHMvdW5pdGUvdW5pdGVDbGllbnRQYWNrYWdlXCI7XG5pbXBvcnQgeyBVbml0ZUNvbmZpZ3VyYXRpb24gfSBmcm9tIFwiLi4vY29uZmlndXJhdGlvbi9tb2RlbHMvdW5pdGUvdW5pdGVDb25maWd1cmF0aW9uXCI7XG5pbXBvcnQgeyBJUGFja2FnZU1hbmFnZXIgfSBmcm9tIFwiLi4vaW50ZXJmYWNlcy9JUGFja2FnZU1hbmFnZXJcIjtcblxuZXhwb3J0IGNsYXNzIEVuZ2luZVZhcmlhYmxlcyB7XG4gICAgcHVibGljIGZvcmNlOiBib29sZWFuO1xuICAgIHB1YmxpYyBlbmdpbmVSb290Rm9sZGVyOiBzdHJpbmc7XG4gICAgcHVibGljIGVuZ2luZUFzc2V0c0ZvbGRlcjogc3RyaW5nO1xuICAgIHB1YmxpYyBlbmdpbmVWZXJzaW9uOiBzdHJpbmc7XG4gICAgcHVibGljIGVuZ2luZURlcGVuZGVuY2llczogeyBbaWQ6IHN0cmluZ106IHN0cmluZyB9O1xuXG4gICAgcHVibGljIHJvb3RGb2xkZXI6IHN0cmluZztcbiAgICBwdWJsaWMgd3d3Um9vdEZvbGRlcjogc3RyaW5nO1xuICAgIHB1YmxpYyBwYWNrYWdlZFJvb3RGb2xkZXI6IHN0cmluZztcbiAgICBwdWJsaWMgcGxhdGZvcm1Sb290Rm9sZGVyOiBzdHJpbmc7XG5cbiAgICBwdWJsaWMgd3d3OiB7XG4gICAgICAgIHNyY0ZvbGRlcjogc3RyaW5nO1xuICAgICAgICBkaXN0Rm9sZGVyOiBzdHJpbmc7XG4gICAgICAgIHVuaXRUZXN0Rm9sZGVyOiBzdHJpbmc7XG4gICAgICAgIHVuaXRUZXN0U3JjRm9sZGVyOiBzdHJpbmc7XG4gICAgICAgIHVuaXRUZXN0RGlzdEZvbGRlcjogc3RyaW5nO1xuICAgICAgICBjc3NTcmNGb2xkZXI6IHN0cmluZztcbiAgICAgICAgY3NzRGlzdEZvbGRlcjogc3RyaW5nO1xuICAgICAgICBlMmVUZXN0Rm9sZGVyOiBzdHJpbmc7XG4gICAgICAgIGUyZVRlc3RTcmNGb2xkZXI6IHN0cmluZztcbiAgICAgICAgZTJlVGVzdERpc3RGb2xkZXI6IHN0cmluZztcbiAgICAgICAgcmVwb3J0c0ZvbGRlcjogc3RyaW5nO1xuICAgICAgICBwYWNrYWdlRm9sZGVyOiBzdHJpbmc7XG4gICAgICAgIGJ1aWxkRm9sZGVyOiBzdHJpbmc7XG4gICAgICAgIGNvbmZpZ3VyYXRpb25Gb2xkZXI6IHN0cmluZztcblxuICAgICAgICBhc3NldHNGb2xkZXI6IHN0cmluZztcbiAgICAgICAgYXNzZXRzU3JjRm9sZGVyOiBzdHJpbmc7XG4gICAgfTtcblxuICAgIHB1YmxpYyBidWlsZFRyYW5zcGlsZUluY2x1ZGU6IHN0cmluZ1tdO1xuICAgIHB1YmxpYyBidWlsZFRyYW5zcGlsZVByZUJ1aWxkOiBzdHJpbmdbXTtcbiAgICBwdWJsaWMgYnVpbGRUcmFuc3BpbGVQb3N0QnVpbGQ6IHN0cmluZ1tdO1xuXG4gICAgcHVibGljIHN5bnRoZXRpY0ltcG9ydDogc3RyaW5nO1xuICAgIHB1YmxpYyBtb2R1bGVJZDogc3RyaW5nO1xuXG4gICAgcHVibGljIHBhY2thZ2VNYW5hZ2VyOiBJUGFja2FnZU1hbmFnZXI7XG5cbiAgICBwcml2YXRlIF9jb25maWd1cmF0aW9uOiB7IFtpZDogc3RyaW5nXTogYW55IH07XG5cbiAgICBwcml2YXRlIF9yZXF1aXJlZERldkRlcGVuZGVuY2llczogc3RyaW5nW107XG4gICAgcHJpdmF0ZSBfcmVtb3ZlZERldkRlcGVuZGVuY2llczogc3RyaW5nW107XG4gICAgcHJpdmF0ZSBfcmVxdWlyZWRDbGllbnRQYWNrYWdlczogeyBbaWQ6IHN0cmluZ106IFVuaXRlQ2xpZW50UGFja2FnZSB9O1xuICAgIHByaXZhdGUgX3JlbW92ZWRDbGllbnRQYWNrYWdlczogeyBbaWQ6IHN0cmluZ106IFVuaXRlQ2xpZW50UGFja2FnZSB9O1xuICAgIHByaXZhdGUgX2V4aXN0aW5nQ2xpZW50UGFja2FnZXM6IHsgW2lkOiBzdHJpbmddOiBVbml0ZUNsaWVudFBhY2thZ2UgfTtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLl9jb25maWd1cmF0aW9uID0ge307XG5cbiAgICAgICAgdGhpcy5zeW50aGV0aWNJbXBvcnQgPSBcIlwiO1xuICAgICAgICB0aGlzLm1vZHVsZUlkID0gXCJcIjtcblxuICAgICAgICB0aGlzLmJ1aWxkVHJhbnNwaWxlSW5jbHVkZSA9IFtdO1xuICAgICAgICB0aGlzLmJ1aWxkVHJhbnNwaWxlUHJlQnVpbGQgPSBbXTtcbiAgICAgICAgdGhpcy5idWlsZFRyYW5zcGlsZVBvc3RCdWlsZCA9IFtdO1xuXG4gICAgICAgIHRoaXMuX3JlcXVpcmVkRGV2RGVwZW5kZW5jaWVzID0gW107XG4gICAgICAgIHRoaXMuX3JlbW92ZWREZXZEZXBlbmRlbmNpZXMgPSBbXTtcbiAgICAgICAgdGhpcy5fcmVxdWlyZWRDbGllbnRQYWNrYWdlcyA9IHt9O1xuICAgICAgICB0aGlzLl9yZW1vdmVkQ2xpZW50UGFja2FnZXMgPSB7fTtcbiAgICAgICAgdGhpcy5fZXhpc3RpbmdDbGllbnRQYWNrYWdlcyA9IHt9O1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRDb25maWd1cmF0aW9uKG5hbWU6IHN0cmluZywgY29uZmlnOiBhbnkpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fY29uZmlndXJhdGlvbltuYW1lXSA9IGNvbmZpZztcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0Q29uZmlndXJhdGlvbjxUPihuYW1lOiBzdHJpbmcpOiBUIHtcbiAgICAgICAgcmV0dXJuIDxUPnRoaXMuX2NvbmZpZ3VyYXRpb25bbmFtZV07XG4gICAgfVxuXG4gICAgcHVibGljIHNldHVwRGlyZWN0b3JpZXMoZmlsZVN5c3RlbTogSUZpbGVTeXN0ZW0sIHJvb3RGb2xkZXI6IHN0cmluZykgOiB2b2lkIHtcbiAgICAgICAgdGhpcy5yb290Rm9sZGVyID0gcm9vdEZvbGRlcjtcbiAgICAgICAgdGhpcy53d3dSb290Rm9sZGVyID0gZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnJvb3RGb2xkZXIsIFwid3d3XCIpO1xuICAgICAgICB0aGlzLnBhY2thZ2VkUm9vdEZvbGRlciA9IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy5yb290Rm9sZGVyLCBcInBhY2thZ2VkXCIpO1xuICAgICAgICB0aGlzLnBsYXRmb3JtUm9vdEZvbGRlciA9IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy5yb290Rm9sZGVyLCBcInBsYXRmb3JtXCIpO1xuICAgICAgICB0aGlzLnd3dyA9IHtcbiAgICAgICAgICAgIHNyY0ZvbGRlcjogZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnd3d1Jvb3RGb2xkZXIsIFwic3JjXCIpLFxuICAgICAgICAgICAgZGlzdEZvbGRlcjogZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnd3d1Jvb3RGb2xkZXIsIFwiZGlzdFwiKSxcbiAgICAgICAgICAgIGNzc1NyY0ZvbGRlcjogZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnd3d1Jvb3RGb2xkZXIsIFwiY3NzU3JjXCIpLFxuICAgICAgICAgICAgY3NzRGlzdEZvbGRlcjogZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnd3d1Jvb3RGb2xkZXIsIFwiY3NzXCIpLFxuICAgICAgICAgICAgZTJlVGVzdEZvbGRlcjogZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnd3d1Jvb3RGb2xkZXIsIFwidGVzdC9lMmVcIiksXG4gICAgICAgICAgICBlMmVUZXN0U3JjRm9sZGVyOiBmaWxlU3lzdGVtLnBhdGhDb21iaW5lKHRoaXMud3d3Um9vdEZvbGRlciwgXCJ0ZXN0L2UyZS9zcmNcIiksXG4gICAgICAgICAgICBlMmVUZXN0RGlzdEZvbGRlcjogZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnd3d1Jvb3RGb2xkZXIsIFwidGVzdC9lMmUvZGlzdFwiKSxcbiAgICAgICAgICAgIHVuaXRUZXN0Rm9sZGVyOiBmaWxlU3lzdGVtLnBhdGhDb21iaW5lKHRoaXMud3d3Um9vdEZvbGRlciwgXCJ0ZXN0L3VuaXRcIiksXG4gICAgICAgICAgICB1bml0VGVzdFNyY0ZvbGRlcjogZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnd3d1Jvb3RGb2xkZXIsIFwidGVzdC91bml0L3NyY1wiKSxcbiAgICAgICAgICAgIHVuaXRUZXN0RGlzdEZvbGRlcjogZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnd3d1Jvb3RGb2xkZXIsIFwidGVzdC91bml0L2Rpc3RcIiksXG4gICAgICAgICAgICByZXBvcnRzRm9sZGVyOiBmaWxlU3lzdGVtLnBhdGhDb21iaW5lKHRoaXMud3d3Um9vdEZvbGRlciwgXCJ0ZXN0L3JlcG9ydHNcIiksXG4gICAgICAgICAgICBhc3NldHNGb2xkZXI6IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy53d3dSb290Rm9sZGVyLCBcImFzc2V0c1wiKSxcbiAgICAgICAgICAgIGFzc2V0c1NyY0ZvbGRlcjogZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnd3d1Jvb3RGb2xkZXIsIFwiYXNzZXRzU3JjXCIpLFxuICAgICAgICAgICAgYnVpbGRGb2xkZXI6IGZpbGVTeXN0ZW0ucGF0aENvbWJpbmUodGhpcy53d3dSb290Rm9sZGVyLCBcImJ1aWxkXCIpLFxuICAgICAgICAgICAgcGFja2FnZUZvbGRlcjogZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnd3d1Jvb3RGb2xkZXIsIFwibm9kZV9tb2R1bGVzXCIpLFxuICAgICAgICAgICAgY29uZmlndXJhdGlvbkZvbGRlcjogZmlsZVN5c3RlbS5wYXRoQ29tYmluZSh0aGlzLnd3d1Jvb3RGb2xkZXIsIFwiY29uZmlndXJhdGlvblwiKVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHB1YmxpYyBpbml0aWFsaXNlUGFja2FnZXMoY2xpZW50UGFja2FnZXM6IHsgW2lkOiBzdHJpbmddOiBVbml0ZUNsaWVudFBhY2thZ2UgfSk6IHZvaWQge1xuICAgICAgICB0aGlzLl9leGlzdGluZ0NsaWVudFBhY2thZ2VzID0gY2xpZW50UGFja2FnZXM7XG4gICAgfVxuXG4gICAgcHVibGljIHRvZ2dsZUNsaWVudFBhY2thZ2Uoa2V5OiBzdHJpbmcsIGNsaWVudFBhY2thZ2U6IFVuaXRlQ2xpZW50UGFja2FnZSwgcmVxdWlyZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgICAgaWYgKHJlcXVpcmVkKSB7XG4gICAgICAgICAgICB0aGlzLmFkZENsaWVudFBhY2thZ2Uoa2V5LCBjbGllbnRQYWNrYWdlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2xpZW50UGFja2FnZShrZXksIGNsaWVudFBhY2thZ2UpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGFkZENsaWVudFBhY2thZ2Uoa2V5OiBzdHJpbmcsIGNsaWVudFBhY2thZ2U6IFVuaXRlQ2xpZW50UGFja2FnZSk6IHZvaWQge1xuICAgICAgICBpZiAoIWNsaWVudFBhY2thZ2UudmVyc2lvbikge1xuICAgICAgICAgICAgY2xpZW50UGFja2FnZS52ZXJzaW9uID0gdGhpcy5maW5kRGVwZW5kZW5jeVZlcnNpb24oY2xpZW50UGFja2FnZS5uYW1lKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yZXF1aXJlZENsaWVudFBhY2thZ2VzW2tleV0gPSBjbGllbnRQYWNrYWdlO1xuICAgIH1cblxuICAgIHB1YmxpYyByZW1vdmVDbGllbnRQYWNrYWdlKGtleTogc3RyaW5nLCBjbGllbnRQYWNrYWdlOiBVbml0ZUNsaWVudFBhY2thZ2UpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fcmVtb3ZlZENsaWVudFBhY2thZ2VzW2tleV0gPSBjbGllbnRQYWNrYWdlO1xuICAgIH1cblxuICAgIHB1YmxpYyB0b2dnbGVEZXZEZXBlbmRlbmN5KGRlcGVuZGVuY2llczogc3RyaW5nW10sIHJlcXVpcmVkOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIGlmIChyZXF1aXJlZCkge1xuICAgICAgICAgICAgdGhpcy5hZGREZXZEZXBlbmRlbmN5KGRlcGVuZGVuY2llcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZURldkRlcGVuZGVuY3koZGVwZW5kZW5jaWVzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBhZGREZXZEZXBlbmRlbmN5KGRlcGVuZGVuY2llczogc3RyaW5nW10pOiB2b2lkIHtcbiAgICAgICAgZGVwZW5kZW5jaWVzLmZvckVhY2goZGVwID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9yZXF1aXJlZERldkRlcGVuZGVuY2llcy5pbmRleE9mKGRlcCkgPCAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVxdWlyZWREZXZEZXBlbmRlbmNpZXMucHVzaChkZXApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVtb3ZlRGV2RGVwZW5kZW5jeShkZXBlbmRlbmNpZXM6IHN0cmluZ1tdKTogdm9pZCB7XG4gICAgICAgIGRlcGVuZGVuY2llcy5mb3JFYWNoKGRlcCA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5fcmVtb3ZlZERldkRlcGVuZGVuY2llcy5pbmRleE9mKGRlcCkgPCAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlZERldkRlcGVuZGVuY2llcy5wdXNoKGRlcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBidWlsZERlcGVuZGVuY2llcyh1bml0ZUNvbmZpZ3VyYXRpb246IFVuaXRlQ29uZmlndXJhdGlvbiwgcGFja2FnZUpzb25EZXBlbmRlbmNpZXM6IHsgW2lkOiBzdHJpbmddOiBzdHJpbmcgfSk6IHZvaWQge1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLl9yZW1vdmVkQ2xpZW50UGFja2FnZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHBrZyA9IHRoaXMuX3JlbW92ZWRDbGllbnRQYWNrYWdlc1trZXldO1xuXG4gICAgICAgICAgICBpZiAocGFja2FnZUpzb25EZXBlbmRlbmNpZXNbcGtnLm5hbWVdKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHBhY2thZ2VKc29uRGVwZW5kZW5jaWVzW3BrZy5uYW1lXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuX2V4aXN0aW5nQ2xpZW50UGFja2FnZXNba2V5XSAmJlxuICAgICAgICAgICAgICAgICF0aGlzLl9leGlzdGluZ0NsaWVudFBhY2thZ2VzW2tleV0uaGFzT3ZlcnJpZGVzKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2V4aXN0aW5nQ2xpZW50UGFja2FnZXNba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMuX2V4aXN0aW5nQ2xpZW50UGFja2FnZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHBrZyA9IHRoaXMuX2V4aXN0aW5nQ2xpZW50UGFja2FnZXNba2V5XTtcblxuICAgICAgICAgICAgaWYgKHBrZy5oYXNPdmVycmlkZXMgfHwgIXRoaXMuX3JlcXVpcmVkQ2xpZW50UGFja2FnZXNba2V5XSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVpcmVkQ2xpZW50UGFja2FnZXNba2V5XSA9IHBrZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGFkZGVkVGVzdERlcGVuZGVuY2llcyA9IFtdO1xuICAgICAgICBjb25zdCByZW1vdmVkVGVzdERlcGVuZGVuY2llcyA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLl9yZXF1aXJlZENsaWVudFBhY2thZ2VzKSB7XG4gICAgICAgICAgICBjb25zdCBwa2cgPSB0aGlzLl9yZXF1aXJlZENsaWVudFBhY2thZ2VzW2tleV07XG5cbiAgICAgICAgICAgIHVuaXRlQ29uZmlndXJhdGlvbi5jbGllbnRQYWNrYWdlc1trZXldID0gcGtnO1xuICAgICAgICAgICAgaWYgKHBrZy5pbmNsdWRlTW9kZSA9PT0gXCJhcHBcIiB8fCBwa2cuaW5jbHVkZU1vZGUgPT09IFwiYm90aFwiKSB7XG4gICAgICAgICAgICAgICAgcGFja2FnZUpzb25EZXBlbmRlbmNpZXNbcGtnLm5hbWVdID0gcGtnLnZlcnNpb247XG5cbiAgICAgICAgICAgICAgICBjb25zdCBpZHggPSB0aGlzLl9yZXF1aXJlZERldkRlcGVuZGVuY2llcy5pbmRleE9mKHBrZy5uYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAoaWR4ID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVxdWlyZWREZXZEZXBlbmRlbmNpZXMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZWRUZXN0RGVwZW5kZW5jaWVzLnB1c2gocGtnLm5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYWRkZWRUZXN0RGVwZW5kZW5jaWVzLnB1c2gocGtnLm5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMudG9nZ2xlRGV2RGVwZW5kZW5jeShhZGRlZFRlc3REZXBlbmRlbmNpZXMsIHRydWUpO1xuICAgICAgICB0aGlzLnRvZ2dsZURldkRlcGVuZGVuY3kocmVtb3ZlZFRlc3REZXBlbmRlbmNpZXMsIGZhbHNlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYnVpbGREZXZEZXBlbmRlbmNpZXMocGFja2FnZUpzb25EZXZEZXBlbmRlbmNpZXM6IHsgW2lkOiBzdHJpbmddOiBzdHJpbmcgfSk6IHZvaWQge1xuICAgICAgICB0aGlzLl9yZW1vdmVkRGV2RGVwZW5kZW5jaWVzLmZvckVhY2goZGVwZW5kZW5jeSA9PiB7XG4gICAgICAgICAgICBpZiAocGFja2FnZUpzb25EZXZEZXBlbmRlbmNpZXNbZGVwZW5kZW5jeV0pIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgcGFja2FnZUpzb25EZXZEZXBlbmRlbmNpZXNbZGVwZW5kZW5jeV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuX3JlcXVpcmVkRGV2RGVwZW5kZW5jaWVzLmZvckVhY2gocmVxdWlyZWREZXBlbmRlbmN5ID0+IHtcbiAgICAgICAgICAgIHBhY2thZ2VKc29uRGV2RGVwZW5kZW5jaWVzW3JlcXVpcmVkRGVwZW5kZW5jeV0gPSB0aGlzLmZpbmREZXBlbmRlbmN5VmVyc2lvbihyZXF1aXJlZERlcGVuZGVuY3kpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZmluZERlcGVuZGVuY3lWZXJzaW9uKHJlcXVpcmVkRGVwZW5kZW5jeTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHRoaXMuZW5naW5lRGVwZW5kZW5jaWVzKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5lbmdpbmVEZXBlbmRlbmNpZXNbcmVxdWlyZWREZXBlbmRlbmN5XSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVuZ2luZURlcGVuZGVuY2llc1tyZXF1aXJlZERlcGVuZGVuY3ldO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE1pc3NpbmcgRGVwZW5kZW5jeSAnJHtyZXF1aXJlZERlcGVuZGVuY3l9J2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGVwZW5kZW5jeSBWZXJzaW9ucyBtaXNzaW5nXCIpO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19
